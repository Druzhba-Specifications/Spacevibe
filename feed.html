<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SpaceVibe by AlexNET | Feed</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
:root{--bg:#071426;--accent:#00d9ff}
body{margin:0;background:var(--bg);color:white;font-family:Inter}
.top{background:#08192f;padding:12px;display:flex;justify-content:space-between}
.brand{color:var(--accent);font-weight:800}
.wrap{padding:14px}
.card{background:#0c1a2f;padding:14px;border-radius:12px;margin-bottom:18px}
.postHead{display:flex;align-items:center;gap:10px}
.pfp{width:48px;height:48px;border-radius:50%;border:2px solid var(--accent);cursor:pointer;object-fit:cover}
.username{cursor:pointer;color:var(--accent);font-weight:700}
.btn{background:var(--accent);border:none;color:#012328;border-radius:7px;padding:8px 10px;font-weight:800;cursor:pointer;margin-top:8px}
</style>
</head>
<body>

<script>
if(!localStorage.getItem("sv_user"))location.href="index.html";
</script>

<div class="top">
  <div class="brand">Feed</div>
  <a href="home.html" style="color:var(--accent);font-weight:700">Home</a>
</div>

<div class="wrap" id="feed">Loading...</div>

<script>
/* firebase */
const cfg={apiKey:"AIzaSyCdJEX1GYr5ji2_uBR49oJ6z6WDC1cCY_Q",authDomain:"spacevibe-backend.firebaseapp.com",databaseURL:"https://spacevibe-backend-default-rtdb.firebaseio.com",projectId:"spacevibe-backend",storageBucket:"spacevibe-backend.firebasestorage.app",messagingSenderId:"258209625594",appId:"1:258209625594:web:a21c48b7e7100462012043"};
firebase.initializeApp(cfg);
const db=firebase.database();

let me=JSON.parse(localStorage.getItem("sv_user"));

/* load posts */
db.ref("posts").on("value",s=>{
  feed.innerHTML="";
  const p=s.val()||{};
  Object.values(p).sort((a,b)=>b.time-a.time).forEach(post=>{
    let div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <div class="postHead">
        <img class="pfp" src="${post.pfp||'https://via.placeholder.com/100'}" onclick="location.href='user.html?u=${post.user}'">
        <div class="username" onclick="location.href='user.html?u=${post.user}'">@${post.user}</div>
      </div>
      <div style="margin-top:10px">${post.text}</div>
      <div style="margin-top:10px;font-size:12px;opacity:0.7">${new Date(post.time).toLocaleString()}</div>
      ${ (me.role==='admin'||me.role==='full-admin') ? `<button class="btn" onclick="requestTakedown('${post.id}','post')">Request Takedown</button>` : '' }
    `;
    feed.appendChild(div);
  });
});

/* request takedown */
function requestTakedown(id,type){
  const reason=prompt("Reason for removal?");
  if(!reason)return;
  db.ref("takedowns/"+id).set({id,type,reason,by:me.username});
  alert("Request sent to full-admins.");
}
</script>
</body>
</html>

<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>SpaceVibe</title><script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script><style>
body{margin:0;font-family:Arial;background:#071424;color:#e6f0f8}
.card{background:#0e1726;border:1px solid #16263a;border-radius:12px;padding:18px;width:360px;margin:auto;margin-top:90px}
input,textarea{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #133040;background:#071425;color:#e6f0f8}
.btn{background:#00d9ff;border:none;color:#041c27;padding:10px;border-radius:8px;width:100%;margin-top:8px;font-weight:700}
#appTop{display:flex;justify-content:space-between;padding:10px;background:#061423;border-bottom:1px solid #133040}
.tab{background:none;border:none;color:#9fb8cf;padding:8px 12px;border-radius:6px}
.tab.active{background:#00d9ff;color:#04202a}
#adminBar{display:none;padding:10px;background:#071a2c;border-bottom:1px solid #133040}
.admin-btn{background:#00d9ff;color:#04202a;padding:7px 10px;border-radius:6px;border:none;font-weight:700;margin-right:8px}
.composer{background:#0b1630;padding:12px;border-radius:8px;margin-bottom:10px;border:1px solid #133040}
.post{background:#0b1628;padding:12px;border-radius:8px;border:1px solid #133040;margin-bottom:12px}
.post-actions{display:flex;gap:12px;margin-top:6px}
.action-btn{background:none;border:none;color:#9fb8cf}
.comment{background:#071726;border:1px solid #0e2a3e;padding:6px;border-radius:6px;margin-top:6px}
.reel{position:relative;background:#000;border-radius:12px;margin-bottom:14px;overflow:hidden;border:1px solid #0f2636}
.reel-media{width:100%;max-height:75vh;object-fit:cover}
.reel-overlay{position:absolute;bottom:10px;left:10px;color:#fff}
.reel-sidebar{position:absolute;right:10px;bottom:80px;display:flex;flex-direction:column;gap:12px}
.reel-btn{width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,0.15);border:none;color:#fff;font-size:17px}
.chat-item{padding:8px;border-radius:6px;margin-bottom:4px;background:#071726;border:1px solid #0e2a3e;cursor:pointer}
.msg{padding:8px;border-radius:6px;margin-top:6px}
.me{background:#00d9ff;color:#04202a;align-self:flex-end}
.them{background:#071726;color:#e6f0f8;align-self:flex-start}
.profile-card{background:#0b1628;border:1px solid #133040;border-radius:8px;padding:12px}
.badge{margin-left:6px;color:#00d9ff;font-weight:700}
</style></head><body>
<div id="auth"><div class="card"><h2>SpaceVibe</h2><h4>Signup</h4><input id="su_user" placeholder="username"><input id="su_email" placeholder="email"><input id="su_pass" type="password" placeholder="password"><textarea id="su_bio" placeholder="bio"></textarea><button class="btn" onclick="signup()">Sign Up</button><h4>Login</h4><input id="li_user" placeholder="username"><input id="li_pass" type="password" placeholder="password"><button class="btn" onclick="login()">Login</button></div></div>
<div id="app" style="display:none">
<div id="appTop"><div><button class="tab active" onclick="switchPage('feed')">Feed</button><button class="tab" onclick="switchPage('reels')">Reels</button><button class="tab" onclick="switchPage('messages')">Messages</button><button class="tab" onclick="switchPage('profile')">Profile</button></div><div id="currentUser"></div></div>
<div id="adminBar"><button class="admin-btn" onclick="buildAdmin()">Admin</button><button class="admin-btn" onclick="buildTakedowns()">Takedowns</button></div>

<div id="feedPage">
<div class="composer"><textarea id="postInput" rows="3" placeholder="Post..."></textarea><button class="btn" onclick="createPost()">Post</button><button class="btn" onclick="showReelUpload()" style="margin-top:6px">Upload Reel</button></div>
<div id="posts"></div>
</div>

<div id="reelsPage" style="display:none"><div id="reelUpload" class="composer" style="display:none"><input id="reel_url" placeholder="image/video URL"><textarea id="reel_cap" placeholder="caption"></textarea><button class="btn" onclick="uploadReel()">Upload</button><button class="btn" onclick="hideReelUpload()">Cancel</button></div><div id="reels"></div></div>

<div id="messagesPage" style="display:none"><div id="chatList"></div><div id="chatBox" style="margin-top:10px;display:flex;flex-direction:column;min-height:300px"></div><input id="msgInput" placeholder="Message"><button class="btn" onclick="sendMessage()">Send</button></div>

<div id="profilePage" style="display:none"><div id="profileCard" class="profile-card"></div></div>

<div id="adminPanel"></div>
<div id="takedownPanel"></div>
</div>

<script>
const firebaseConfig={apiKey:"AIzaSyCdJEX1GYr5ji2_uBR49oJ6z6WDC1cCY_Q",authDomain:"spacevibe-backend.firebaseapp.com",databaseURL:"https://spacevibe-backend-default-rtdb.firebaseio.com",projectId:"spacevibe-backend",storageBucket:"spacevibe-backend.firebasestorage.app",messagingSenderId:"258209625594",appId:"1:258209625594:web:a21c48b7e7100462012043"};firebase.initializeApp(firebaseConfig);const db=firebase.database();
let user=null,allUsers={},allPosts={},allReels={},allMsgs={},chatTarget=null;

function g(x){return document.getElementById(x)}
function signup(){let u=su_user.value.trim(),e=su_email.value.trim(),p=su_pass.value,b=su_bio.value;if(!u||!p)return alert("missing");db.ref("users/"+u).once("value",s=>{if(s.exists())return alert("taken");let emailHash=md5(e),verified=(e==="alexsentme");let o={username:u,password:md5(p),emailHash,verified,bio:b,role:"regular",certified:false,followers:[],following:[]};db.ref("users/"+u).set(o);user=o;showApp();})}
function login(){let u=li_user.value.trim(),p=li_pass.value;if(!u||!p)return;db.ref("users/"+u).once("value",s=>{if(!s.exists())return alert("no user");let d=s.val();if(d.password!==md5(p))return alert("bad pass");user=d;showApp();})}
function showApp(){auth.style.display="none";app.style.display="block";currentUser.innerHTML="@"+user.username;if(user.username==="alexmaxxing")db.ref("users/"+user.username+"/role").set("full-admin");db.ref("users").on("value",s=>{allUsers=s.val()||{};if(allUsers[user.username])user=allUsers[user.username];updateAdmin();renderProfile();renderChatList();});db.ref("posts").on("value",s=>{allPosts=s.val()||{};renderPosts();renderProfile()});db.ref("reels").on("value",s=>{allReels=s.val()||{};renderReels();renderProfile()});db.ref("messages").on("value",s=>{allMsgs=s.val()||{};renderChat()});}
function switchPage(p){feedPage.style.display=(p==="feed")?"block":"none";reelsPage.style.display=(p==="reels")?"block":"none";messagesPage.style.display=(p==="messages")?"block":"none";profilePage.style.display=(p==="profile")?"block":"none";}

function createPost(){let t=postInput.value.trim();if(!t)return;let id=Date.now();db.ref("posts/"+id).set({id,by:user.username,text:t,time:Date.now(),likes:[],comments:[]});postInput.value=""}
function renderPosts(){posts.innerHTML="";Object.values(allPosts).sort((a,b)=>b.time-a.time).forEach(p=>{let liked=p.likes&&p.likes.includes(user.username);let s=`<div class='post'><b>@${p.by}</b> Â· ${timeAgo(p.time)}<div>${p.text}</div><div class='post-actions'><button class='action-btn' onclick="toggleLike('${p.id}')">${liked?"â™¥":"â™¡"}</button><button class='action-btn' onclick="promptComment('${p.id}')">ðŸ’¬</button><button class='action-btn' onclick="requestTake('post','${p.id}')">ðŸš¨</button></div>`;if(p.comments)Object.values(p.comments).forEach(c=>{s+=`<div class='comment'><b>@${c.by}</b> ${c.text}</div>`});s+=`</div>`;posts.innerHTML+=s})}
function toggleLike(id){let p=allPosts[id];if(!p.likes)p.likes=[];let i=p.likes.indexOf(user.username);if(i>=0)p.likes.splice(i,1);else p.likes.push(user.username);db.ref("posts/"+id+"/likes").set(p.likes)}
function promptComment(id){let t=prompt("Comment:");if(!t)return;let c={by:user.username,text:t,time:Date.now()};db.ref("posts/"+id+"/comments/"+Date.now()).set(c)}

function showReelUpload(){reelUpload.style.display="block"}
function hideReelUpload(){reelUpload.style.display="none"}
function uploadReel(){let url=reel_url.value||"https://placehold.co/600x800",cap=reel_cap.value.trim();let id=Date.now();db.ref("reels/"+id).set({id,by:user.username,url,caption:cap,time:Date.now(),likes:[],comments:[]});reel_url.value="";reel_cap.value="";hideReelUpload()}
function renderReels(){reels.innerHTML="";Object.values(allReels).sort((a,b)=>b.time-a.time).forEach(r=>{let liked=r.likes&&r.likes.includes(user.username);let s=`<div class='reel'><img src="${r.url}" class='reel-media'><div class='reel-overlay'><b>@${r.by}</b><div>${r.caption}</div></div><div class='reel-sidebar'><button class='reel-btn' onclick="toggleReelLike('${r.id}')">${liked?"â™¥":"â™¡"}</button><button class='reel-btn' onclick="promptReelComment('${r.id}')">ðŸ’¬</button><button class='reel-btn' onclick="requestTake('reel','${r.id}')">ðŸš¨</button></div>`;if(r.comments)Object.values(r.comments).forEach(c=>{s+=`<div class='comment'><b>@${c.by}</b> ${c.text}</div>`});s+=`</div>`;reels.innerHTML+=s})}
function toggleReelLike(id){let r=allReels[id];if(!r.likes)r.likes=[];let i=r.likes.indexOf(user.username);if(i>=0)r.likes.splice(i,1);else r.likes.push(user.username);db.ref("reels/"+id+"/likes").set(r.likes)}
function promptReelComment(id){let t=prompt("Comment:");if(!t)return;let c={by:user.username,text:t,time:Date.now()};db.ref("reels/"+id+"/comments/"+Date.now()).set(c)}

function renderProfile(){let u=user;let f=u.followers?u.followers.length:0,l=u.following?u.following.length:0,p=Object.values(allPosts).filter(x=>x.by===u.username).length,r=Object.values(allReels).filter(x=>x.by===u.username).length;profileCard.innerHTML=`<h3>@${u.username}${u.certified?"<span class='badge'>âœ”</span>":""}</h3><div>${u.bio||""}</div><div>Followers: ${f}</div><div>Following: ${l}</div><div>Posts: ${p}</div><div>Reels: ${r}</div>`}

function renderChatList(){chatList.innerHTML="";Object.values(allUsers).forEach(u=>{if(u.username===user.username)return;if(user.username==="alexmaxxing"|| (u.followers&&u.followers.includes(user.username) && user.followers&&user.followers.includes(u.username))){chatList.innerHTML+=`<div class='chat-item' onclick="openChat('${u.username}')">@${u.username}</div>`}})}
function openChat(u){chatTarget=u;g("chatBox").innerHTML="Chat with @"+u}
function sendMessage(){if(!chatTarget)return;let t=msgInput.value.trim();if(!t)return;let id=Date.now();let m={from:user.username,to:chatTarget,text:t,time:Date.now()};db.ref("messages/"+id).set(m);msgInput.value=""}
function renderChat(){if(!chatTarget)return;let msgs=Object.values(allMsgs).filter(m=>(m.from===user.username&&m.to===chatTarget)||(m.from===chatTarget&&m.to===user.username));chatBox.innerHTML="";msgs.sort((a,b)=>a.time-b.time).forEach(m=>{chatBox.innerHTML+=`<div class='msg ${m.from===user.username?"me":"them"}'>${m.text}</div>`})}

function updateAdmin(){adminBar.style.display=(user.role==="admin"||user.role==="full-admin")?"block":"none"}
function buildAdmin(){if(user.role!=="full-admin")return alert("nope");let s="<h3>Admin</h3>";Object.values(allUsers).forEach(u=>{s+=`<div>@${u.username} â€” <select onchange="setRole('${u.username}',this.value)"><option value="regular"${u.role==="regular"?" selected":""}>Regular</option><option value="certified"${u.role==="certified"?" selected":""}>Certified</option><option value="admin"${u.role==="admin"?" selected":""}>Admin</option><option value="full-admin"${u.role==="full-admin"?" selected":""}>Full Admin</option></select></div>`});adminPanel.innerHTML=s}
function setRole(u,r){db.ref("users/"+u+"/role").set(r);if(r==="certified")db.ref("users/"+u+"/certified").set(true);if(r==="regular")db.ref("users/"+u+"/certified").set(false)}

function requestTake(type,id){let k=Date.now();db.ref("takedowns/"+k).set({id,type,by:user.username,time:Date.now()})}
function buildTakedowns(){if(user.role!=="full-admin")return alert("no");takedownPanel.innerHTML="";db.ref("takedowns").once("value",s=>{let v=s.val()||{};Object.values(v).forEach(t=>{takedownPanel.innerHTML+=`<div>REQ ${t.type} ${t.id} by @${t.by} <button onclick="approveTake('${t.type}','${t.id}','${t.time}')">Approve</button></div>`})})}
function approveTake(type,id,time){if(type==="post")db.ref("posts/"+id).remove();if(type==="reel")db.ref("reels/"+id).remove();db.ref("takedowns/"+time).remove()}
function timeAgo(x){let s=(Date.now()-x)/1000;if(s<60)return"now";let m=s/60;if(m<60)return Math.floor(m)+"m";let h=m/60;if(h<24)return Math.floor(h)+"h";return Math.floor(h/24)+"d";}
</script>
</body></html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SpaceVibe by AlexNET | Profile</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
:root{--bg:#071426;--accent:#00d9ff;--muted:#9fbfd6}
body{margin:0;background:var(--bg);color:#e6f7ff;font-family:Inter}
.top{display:flex;justify-content:space-between;align-items:center;padding:12px;background:linear-gradient(180deg,#071725,#08192f)}
.brand{color:var(--accent);font-weight:800}
.wrap{max-width:700px;margin:20px auto;padding:12px}
.card{background:linear-gradient(180deg,#071725,#08192f);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.pfp{width:80px;height:80px;border-radius:14px;background:#0d2038;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:900}
.counts{margin-top:14px;display:flex;gap:20px}
.small{color:var(--muted);font-size:13px}
.btn{background:var(--accent);color:#012328;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:800;margin-top:8px}
</style>
</head>
<body>

<script>
if(!localStorage.getItem('sv_user'))location.href='index.html'
</script>

<div class="top">
  <div class="brand">SpaceVibe by AlexNET</div>
  <a href="home.html" style="color:var(--accent);text-decoration:none;font-weight:700">Home</a>
</div>

<div class="wrap">
  <div id="profile" class="card">Loading...</div>
</div>

<script>
/* firebase */
const firebaseConfig={apiKey:"AIzaSyCdJEX1GYr5ji2_uBR49oJ6z6WDC1cCY_Q",authDomain:"spacevibe-backend.firebaseapp.com",databaseURL:"https://spacevibe-backend-default-rtdb.firebaseio.com",projectId:"spacevibe-backend",storageBucket:"spacevibe-backend.firebasestorage.app",messagingSenderId:"258209625594",appId:"1:258209625594:web:a21c48b7e7100462012043"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let user=JSON.parse(localStorage.getItem('sv_user'));

/* get fresh user */
db.ref("users/"+user.username).once("value").then(s=>{
  if(s.exists()){
    user=s.val();
    localStorage.setItem('sv_user',JSON.stringify(user));
    loadProfile();
  }
});

/* count posts & reels */
function loadProfile(){
  Promise.all([
    db.ref("posts").once("value"),
    db.ref("reels").once("value")
  ]).then(([pSnap,rSnap])=>{
    const posts=pSnap.val()||{};
    const reels=rSnap.val()||{};
    const pCount=Object.values(posts).filter(x=>x.user===user.username).length;
    const rCount=Object.values(reels).filter(x=>x.by===user.username).length;

    profile.innerHTML=`
      <div style="display:flex;gap:12px;align-items:center">
        <div class="pfp">${user.pfp?`<img src="${user.pfp}" style="width:100%;height:100%;border-radius:14px;object-fit:cover">`:`${user.username[0].toUpperCase()}`}</div>
        <div>
          <div style="font-weight:800;font-size:22px">@${user.username}${user.certified?"<span style='color:var(--accent);margin-left:6px;font-weight:900'>âœ”</span>":""}</div>
          <div class="small">${user.bio||""}</div>
        </div>
      </div>

      <div class="counts">
        <div><b>${user.followers?user.followers.length:0}</b><div class="small">Followers</div></div>
        <div><b>${user.following?user.following.length:0}</b><div class="small">Following</div></div>
        <div><b>${pCount}</b><div class="small">Posts</div></div>
        <div><b>${rCount}</b><div class="small">Reels</div></div>
      </div>

      <button class="btn" onclick="goSettings()">Settings</button>
    `;
  });
}

function goSettings(){location.href='settings.html'}
</script>
</body>
</html>
